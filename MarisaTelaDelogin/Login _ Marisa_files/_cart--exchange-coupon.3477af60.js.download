!function(e,n){"use strict";function a(){n(".exchange-coupon--controls-wrapper").each(function(e){n(this).attr("data-exchange-coupon-uid",e+1),n(this).find("[data-exchange-coupon-remove-uid]").attr("data-exchange-coupon-remove-uid",e+1)})}e.component("cart:exchange-coupon",{active:!0,unlock:function(){var e=n(this).parents("form");e.find("hgroup .pull-right").addClass("hidden"),e.find(".exchange-coupon--controls-wrapper").removeClass("hidden"),e.find(".exchange-coupon--add-item--wrapper").removeClass("hidden"),recalcMatchHeight()},lock:function(){var e=n(".exchange-coupon--controls-wrapper").parents("form");e.find("hgroup .pull-right").removeClass("hidden"),e.find(".exchange-coupon--controls-wrapper").addClass("hidden"),e.find(".exchange-coupon--add-item--wrapper").addClass("hidden"),e.find('[type="submit"]').attr("disabled",!1),e.find('[name="exchange-coupon"]').attr("disabled",!1).val(""),a()},addNewExchangeCoupon:function(){n(".exchange-coupon--controls-wrapper").find(".span_success").remove();var e=n(".exchange-coupon--controls-wrapper"),o=e.first().clone(),a=(o.find('[data-match-height="exchange-coupon"]').removeAttr("style"),e.last().data("exchange-coupon-uid")+1);o.attr("data-exchange-coupon-uid",a),o.find('[name="exchange-coupon"]').val("").attr("disabled",!1),o.find('[name="exchange-coupon"]').val("").attr("data-control",a),o.find(".exchange-coupon--confirm").attr("disabled",!1),o.find(".exchange-coupon--remove-item").attr("data-exchange-coupon-remove-uid",a),e.last().after(o),n(".exchange-coupon--confirm").last().attr("data-control",a)},removeExchangeCoupon:function(o){var e;1<=n(".exchange-coupon--controls-wrapper").length&&(e="voucherCode="+n("input[data-control='"+o+"']").val())?n.ajax({url:"/cart/remove-voucher",type:"POST",data:e,success:function(e){1<n(".exchange-coupon--controls-wrapper").length?n('.exchange-coupon--controls-wrapper[data-exchange-coupon-uid="'+o+'"]').remove():(n(".exchange-coupon--controls-wrapper[data-exchange-coupon-uid='"+o+"']").find('[name="exchange-coupon"]').val(""),n("input[data-control='"+o+"']").removeAttr("disabled"),n(".exchange-coupon--confirm[data-control='"+o+"']").removeAttr("disabled"),1<=n(".exchange-coupon--controls-wrapper[data-exchange-coupon-uid='"+o+"']").find(".span_success").length&&n(".exchange-coupon--controls-wrapper[data-exchange-coupon-uid='"+o+"'] .span_success").remove(),n(".exchange-coupon--controls-wrapper").addClass("hidden"),n(".tagAddVoucher").removeClass("hidden"),n(".exchange-coupon--add-item--wrapper").addClass("hidden")),n("#subTotal").html(e.subTotal),n("#totalDiscounts").html(e.totalDiscounts),n("#deliveryCost").html(e.deliveryCost),n("#totalOrder").html(e.totalOrder),n("#echangeVoucherTotal").html(e.exchangeVouchersValue)},error:function(e,o,a){console.log("The following error occured: "+o,a)}}):(n(".exchange-coupon--controls-wrapper[data-exchange-coupon-uid='"+o+"']").find('[name="exchange-coupon"]').val(""),n(".exchange-coupon--controls-wrapper[data-exchange-coupon-uid='"+o+"']").find('[name="exchange-coupon"]').focus()),n(".errorSend").last().remove(),a(),1==n(".exchange-coupon--controls-wrapper.hidden").length&&location.reload()},confirmCoupon:function(a){var e="voucherCode="+n("input[data-control='"+a+"']").val(),e=(n.ajax({url:"/cart/add-voucher",type:"POST",data:e,success:function(e){var o=n("input[name='exchange-coupon']").last();1<=e.listError.length?(n(".errorSend").last().remove(),n(o).after('<span class="span_error errorSend">'+e.listError[0].error+"</span>"),n(o).removeAttr("disabled"),n(o).val(""),n(o).focus(),n(".exchange-coupon--confirm").last().removeAttr("disabled")):(n(".errorSend").last().remove(),n("input[data-control='"+a+"']").attr("disabled","disabled"),n(".exchange-coupon--confirm[data-control='"+a+"']").attr("disabled","disabled"),n(o).after('<span class="span_success">'+n("#vValid").val()+"</span>"),n("#subTotal").html(e.subTotal),n("#totalDiscounts").html(e.totalDiscounts),n("#deliveryCost").html(e.deliveryCost),n("#totalOrder").html(e.totalOrder),n("#echangeVoucherTotal").html(e.exchangeVouchersValue))},error:function(e,o,a){console.log("The following error occured: "+o,a)}}),n(this).find(".exchange-coupon--controls-wrapper").last());e.find('[name="exchange-coupon"]').attr("disabled",!0),e.find(".exchange-coupon--confirm").attr("disabled",!0)},validateCoupon:function(){var e=n(".exchange-coupon--controls-wrapper").last().find('[name="exchange-coupon"]').not(":disabled");e.val().trim().length?n(this).trigger("exchange-coupon:confirm-coupon"):e.focus()}})}(Marisa,jQuery);