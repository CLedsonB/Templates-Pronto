ACC.productorderform={_autoload:["headerActions","coreTableActions","addToCartOrderGridForm"],$addToCartOrderForm:$("#AddToCartOrderForm"),$addToCartBtn:$("#addToCartBtn"),$omsErrorMessageContainer:$("#globalMessages"),$emptySkuQuantityInputs:$(".sku-quantity[value]"),$nonEmptySkuQuantityInputs:$(".sku-quantity[value]"),$totalGridValues:$("[data-grid-total-id]"),$futureTooltipTemplate:$("#future-stock-template"),$futureTooltipErrorTemplate:$("#future-tooltip-error-template"),$omsErrorMessageTemplate:$("#oms-error-message-template"),$variantSummaryTemplate:$("#variant-summary"),selectedVariantData:"selected-variant",selectedVariants:[],quantityTotal:0,scrollTopPos:0,headerActions:function(){ACC.productorderform.bindProductDetailToggle($(".product-details-toggle"))},coreTableActions:function(){ACC.productorderform.coreTableScrollActions(ACC.productorderform.$addToCartOrderForm),ACC.productorderform.bindUpdateFutureStockButton(".update_future_stock_button"),ACC.productorderform.bindHideFutureStockInfo(".hide_future_stock_info"),ACC.productorderform.bindVariantSelect($(".variant-select-btn"),"AddToCartOrderForm"),ACC.productorderform.cancelVariantModal(".closeVariantModal");var r=".sku-quantity",t="#cboxContent .sku-quantity",f=0,C=0;ACC.productorderform.$addToCartOrderForm.on("click",r,function(r){$(this).select()}),ACC.productorderform.$addToCartOrderForm.on("focusin",r,function(r){f=jQuery.trim(this.value),$(this).parents("tr").next(".variant-summary").remove(),$(this).parents("table").data(ACC.productorderform.selectedVariantData)?ACC.productorderform.selectedVariants=$(this).parents("table").data(ACC.productorderform.selectedVariantData):ACC.productorderform.selectedVariants=[],""==f&&(f=0,this.value=0)}),$(r).on("blur",function(r){var t,e,o,a,d,n=parseInt($(this).attr("id").match("[0-9]+")),i=0,s=$("input[id='productPrice["+n+"]']").val(),l=(this.value=ACC.productorderform.filterSkuEntry(this.value),$(".js-total-items-count")),u=l.html(),c=$(".js-total-price-value").val(),p=$(this).parents(".orderForm_grid_group");isNaN(jQuery.trim(this.value))&&(this.value=0),""==(C=jQuery.trim(this.value))&&(C=0,this.value=0),ACC.orderform?(void 0!==sessionStorage.totalItems&&void 0!==sessionStorage.totalPriceVal&&(u=sessionStorage.totalItems,c=sessionStorage.totalPriceVal),i=0==f?(l.html(parseInt(u)+parseInt(C)),parseFloat(c)+parseFloat(s)*parseInt(C)):(l.html(parseInt(u)+(parseInt(C)-parseInt(f))),parseFloat(c)+parseFloat(s)*(parseInt(C)-parseInt(f))),sessionStorage.totalPrice=ACC.productorderform.formatTotalsCurrency(i),sessionStorage.totalItems=l.html(),sessionStorage.totalPriceVal=i,ACC.orderform.addToSkuQtyInput(this)):p&&0<p.length&&(t=p.find("#quantityValue"),e=p.find("#avgPriceValue"),o=p.find("#subtotalValue"),a=t.val(),d=o.val(),i=0==f?(t.val(parseInt(a)+parseInt(C)),o.val(parseFloat(d)+parseFloat(s)*parseInt(C)),l.html(parseInt(u)+parseInt(C)),parseFloat(c)+parseFloat(s)*parseInt(C)):(t.val(parseInt(a)+(parseInt(C)-parseInt(f))),o.val(parseFloat(d)+parseFloat(s)*(parseInt(C)-parseInt(f))),l.html(parseInt(u)+(parseInt(C)-parseInt(f))),parseFloat(c)+parseFloat(s)*(parseInt(C)-parseInt(f))),ACC.productorderform.enableBeforeUnloadEvent(C,l.text()),0!=l.length&&0==l.text()?(ACC.productorderform.$addToCartBtn.attr("disabled","disabled"),$(window).off("beforeunload",ACC.productorderform.beforeUnloadHandler)):ACC.productorderform.$addToCartBtn.removeAttr("disabled"),0<parseInt(t.val())?e.val(parseFloat(o.val())/parseInt(t.val())):e.val(0)),p&&0<p.length&&(a="",d=p.find("[data-grid-total-id=total_value_"+n+"]"),0<C&&(a=ACC.productorderform.formatTotalsCurrency(parseFloat(s)*parseInt(C))),d.html(a),ACC.productorderform.updateSelectedVariantGridTotal(this,f,!1,!1)),$(".js-total-price").html(ACC.productorderform.formatTotalsCurrency(i)),$(".js-total-price-value").val(i)}),$("body").on("focusin",t,function(){f=jQuery.trim(this.value);var r=$(this).data("variant-id"),r=$("#AddToCartOrderForm, #cartOrderGridForm").find("[data-variant-id='"+r+"']");r.trigger("focusin"),r.parents("table").find(".variant-summary").remove(),r.parents("table").data(ACC.productorderform.selectedVariantData)?ACC.productorderform.selectedVariants=r.parents("table").data(ACC.productorderform.selectedVariantData):ACC.productorderform.selectedVariants=[],""==f&&(f=0,this.value=0)}),$("body").on("blur",t,function(){var r=$(this).siblings(".price"),t=$(this).siblings(".data-grid-total"),e=$(this).data("variant-id"),e=$("#AddToCartOrderForm, #cartOrderGridForm").find("[data-variant-id='"+e+"']");this.value=ACC.productorderform.filterSkuEntry(this.value),(isNaN(jQuery.trim(this.value))||this.value<0||""==this.value)&&(this.value=0),e.val(this.value),e.trigger("blur"),ACC.productorderform.updateVariantTotal(r,this.value,t),0<this.value&&this.value!=f?(e.parents("table").addClass("selected"),e.trigger("change")):0===ACC.productorderform.selectedVariants.length&&e.parents("table").removeClass("selected")})},updateSelectedVariantGridTotal:function(e,r,t,o){var a,d=$(e).siblings(".price"),n=$(e).siblings(".variant-prop"),i=$(e).next(".td_stock").data("sku-id"),s=$(e).siblings(".data-grid-total");t&&(ACC.productorderform.selectedVariants=[]),e.value!=r&&(a=!0,ACC.productorderform.selectedVariants.forEach(function(r,t){r.id===i&&(a=!1,"0"===e.value||0===e.value?ACC.productorderform.selectedVariants.splice(t,1):(ACC.productorderform.selectedVariants[t].quantity=e.value,ACC.productorderform.selectedVariants[t].total=ACC.productorderform.updateVariantTotal(d,e.value,s)))}),a&&0<e.value&&ACC.productorderform.selectedVariants.push({id:i,size:n.data("variant-prop"),quantity:e.value,total:ACC.productorderform.updateVariantTotal(d,e.value,s)})),o&&$(e).parents("table").find(".variant-summary").remove(),ACC.productorderform.showSelectedVariant($(e).parents("table")),0<e.value&&e.value!=r?$(e).parents("table").addClass("selected"):0===ACC.productorderform.selectedVariants.length&&$(e).parents("table").removeClass("selected").find(".variant-summary").remove()},updateVariantTotal:function(r,t,e){r=parseFloat(r.data("variant-price"))*parseInt(t);return e.html(ACC.productorderform.formatTotalsCurrency(r)),ACC.productorderform.formatTotalsCurrency(r)},bindUpdateFutureStockButton:function(r){$("body").on("click",r,function(r){r.preventDefault();var t=$(this).parents(".orderForm_grid_group").find(".product-grid-container"),e=jQuery.map(t.find("input[type='hidden'].sku"),function(r){return r.value}),o=$(this).data("skusId"),r=$(this).data("skusFutureStockUrl"),a={skus:e,productCode:o},d=$(this).parent().find(".hide_future_stock_info"),n=$(this);$.ajax({url:r,type:"POST",data:a,traditional:!0,dataType:"json",success:function(r){ACC.productorderform.updateFuture(t,e,r,o,n,d)},error:function(r,t,e){alert("Failed to get delivery modes. Error details ["+r+", "+t+", "+e+"]")}})})},bindHideFutureStockInfo:function(r){$("body").on("click",r,function(r){r.preventDefault();r=$(this).parent().parent().find(".product-grid-container");$(this).parent().find(".update_future_stock_button").show(),$(this).hide(),r.find("[data-sku-id]").children(".future_stock, .out-of-stock").remove()})},updateFuture:function(d,r,n,t,e,o){ACC.productorderform.$omsErrorMessageContainer.find("div").remove(),null!==n&&void 0!==n["basket.page.viewFuture.unavailable"]?$.tmpl(ACC.productorderform.$omsErrorMessageTemplate,{errorMessage:n["basket.page.viewFuture.unavailable"]}).appendTo(ACC.productorderform.$omsErrorMessageContainer):Object.keys(n).length<=0||(e.hide(),o.css("display","block"),$.each(r,function(r,t){var e=n[t],t=d.find("[data-sku-id='"+t+"']"),o=-1!=t[0].attributes.class.nodeValue.indexOf("in-stock"),a=null!=e&&null!==e[0]&&void 0!==e[0];t.children(".future_stock, .out-of-stock").remove(),a?(o||t.addClass("future-stock"),$.tmpl(ACC.productorderform.$futureTooltipTemplate,{formattedDate:e[0].formattedDate,availabilities:e}).appendTo(t)):o||(t[0].attributes.class.nodeValue="td_stock out-of-stock")}))},toJSON:function(r,t){for(var e=r.find("input.sku").map(function(r,t){return t.value}),o=r.find("input.sku-quantity").map(function(r,t){return parseInt(t.value)}),a=[],d=0;d<e.length;d++)t&&0===o[d]||a.push({product:{code:e[d]},quantity:o[d]});return JSON.stringify({cartEntries:a})},formatTotalsCurrency:function(r){return Currency.formatMoney(Number(r).toFixed(2),Currency.money_format[ACC.common.currentCurrency])},cleanValues:function(){var r;0!==$(".orderForm_grid_group").length&&(r=ACC.productorderform.formatTotalsCurrency("0.00"),$(".js-total-price").html(r),$("#quantity, .js-total-items-count").html(0),$("#quantityValue, #avgPriceValue, #subtotalValue, .js-total-price-value").val(0),ACC.productorderform.$emptySkuQuantityInputs.val(0),ACC.productorderform.$totalGridValues.html(""))},calculateGrid:function(){ACC.productorderform.$nonEmptySkuQuantityInputs.trigger("focusout")},bindProductDetailToggle:function(r){r.on("click",function(r){r.preventDefault(),$(this).parents(".product-details").toggleClass("open")})},showSelectedVariant:function(r){$.tmpl(ACC.productorderform.$variantSummaryTemplate,{variants:ACC.productorderform.selectedVariants}).appendTo(r),$(".variant-summary .variant-property").html($(".variant-detail").data("variant-property")),r.data(ACC.productorderform.selectedVariantData,ACC.productorderform.selectedVariants),r.removeClass("currentVariant")},bindVariantSelect:function(a,d){a.on("click",function(r){r.preventDefault();var r=$(this).parents("table"),t=(r.data(ACC.productorderform.selectedVariantData)?ACC.productorderform.selectedVariants=r.data(ACC.productorderform.selectedVariantData):ACC.productorderform.selectedVariants=[],a.html()),e=$("#"+d).clone().empty().attr("id",d+"Variant"),o=(r.addClass("currentVariant"),$(this).parents(".orderForm_grid_group").clone());r.removeClass("currentVariant"),$(o).find(".currentVariant").siblings().remove(),e.html(o),e.find(".hidden-xs").removeClass("hidden-xs"),e.find(".hide").removeClass("hide"),scrollTopPos=$("body").scrollTop(),$("body").scrollTop(0),ACC.colorbox.open(t,{html:e,width:"100%",reposition:!1,className:"variantSelectMobile",onCleanup:function(){0<ACC.productorderform.$addToCartOrderForm.find(".selected").length?ACC.productorderform.$addToCartBtn.removeAttr("disabled"):ACC.productorderform.$addToCartBtn.attr("disabled","disabled"),$("body").scrollTop(scrollTopPos)}})})},cancelVariantModal:function(r){$("body").on("click",r,function(r){r.preventDefault(),ACC.colorbox.close()})},resetSelectedVariant:function(){ACC.productorderform.selectedVariants=[],$(".product-grid-container table").removeData(ACC.productorderform.selectedVariantData).removeClass("selected").removeClass("currentVariant")},addToCartOrderGridForm:function(){$("#AddToCartOrderForm").keypress(function(r){"13"==r.which&&r.preventDefault()}),ACC.productorderform.$addToCartBtn.click(function(){ACC.productorderform.$addToCartBtn.attr("disabled","disabled"),$.ajax({url:ACC.productorderform.$addToCartOrderForm.attr("action"),type:"POST",dataType:"json",contentType:"application/json",data:ACC.productorderform.toJSON(ACC.productorderform.$addToCartOrderForm,!0),async:!1,success:function(r){$(window).off("beforeunload",ACC.productorderform.beforeUnloadHandler),ACC.product.displayAddToCartPopup(r),ACC.productorderform.cleanValues(),ACC.productorderform.resetSelectedVariant()},error:function(r,t,e){console.log("The following error occured: "+t,e)}})})},beforeUnloadHandler:function(){return ACC.productorderform.$addToCartOrderForm.attr("data-grid-confirm-message")},enableBeforeUnloadEvent:function(r,t){ACC.orderform||0<r&&0<t&&$(window).off("beforeunload",ACC.productorderform.beforeUnloadHandler).on("beforeunload",ACC.productorderform.beforeUnloadHandler)},filterSkuEntry:function(r){return/\D/g.test(r)?r.replace(/\D/g,""):r},coreTableScrollActions:function(e){var r,t,o,a,d,n,i,s,l,u;e.hasClass("visible")&&(ACC.productorderform.orderGridScroll(e),r=e.parent().find(".order-form-scroll.right"),t=e.parent().find(".order-form-scroll.left"),o=e.parent().find(".order-form-scroll.up"),a=e.parent().find(".order-form-scroll.down"),d=e.find(".widthReference").outerWidth(),n=e.find(".product-grid-container table").eq(0).height()/2,u=l=s=i=0,e.find(".product-grid-container table").each(function(){$(this).outerWidth()>i&&(i=$(this).outerWidth())}),e.find(".orderForm_grid_group").each(function(){s+=$(this).height()}),l=i-e.outerWidth(),u=s-e.height()+14,e.scroll(function(){0<$(this).scrollLeft()?t.show():t.hide(),$(this).scrollLeft()>=l?r.hide():r.show(),0<$(this).scrollTop()?o.show():o.hide(),$(this).scrollTop()>=u?a.hide():a.show(),e.find(".update-future-stock").css("margin-right",-$(this).scrollLeft())}),e.parent().find(".order-form-scroll").click(function(){var r=e.scrollLeft(),t=e.scrollTop();$(this).hasClass("right")?e.scrollLeft(r+d):$(this).hasClass("left")?e.scrollLeft(r-d):$(this).hasClass("up")?e.scrollTop(t-n):e.scrollTop(t+n)}))},orderGridScroll:function(r){var t=!1,e=0,o=$(r).find(".orderForm_grid_group").innerWidth(),a=$(r).innerHeight()-18;$(r).find(".product-grid-container table").each(function(){$(this).width()>o&&(t=!0),e+=$(this).height()}),t&&$(r).parent().find(".order-form-scroll.right").show(),a<e&&$(r).parent().find(".order-form-scroll.down").show()},calculateVariantTotal:function(r,t){var e=r.parents(".orderForm_grid_group"),r=parseInt(r.attr("id").match("[0-9]+")),o=$("input[id='productPrice["+r+"]']").val(),e=e.find("[data-grid-total-id=total_value_"+r+"]");0<t&&e.html(ACC.productorderform.formatTotalsCurrency(parseFloat(o)*parseInt(t)))}};