ACC.savedcarts={_autoload:[["bindRestoreSavedCartClick",0!=$(".js-restore-saved-cart").length],["bindDeleteSavedCartLink",0!=$(".js-delete-saved-cart").length],["bindDeleteConfirmLink",0!=$(".js-savedcart_delete_confirm").length],["bindSaveCartForm",0!=$(".js-save-cart-link").length||0!=$(".js-update-saved-cart").length],["bindUpdateUploadingSavedCarts",0!=$(".js-uploading-saved-carts-update").length]],$savedCartRestoreBtn:{},$currentCartName:{},bindRestoreSavedCartClick:function(){$(".js-restore-saved-cart").click(function(e){e.preventDefault();var t=$(this).data("restore-popup-title"),e=$(this).data("savedcart-id"),e=ACC.config.encodedContextPath+"/my-account/saved-carts/"+e+"/restore";$.get(e).done(function(e){ACC.colorbox.open(t,{html:e,width:500,onComplete:function(){ACC.common.refreshScreenReaderBuffer(),ACC.savedcarts.bindRestoreModalHandlers(),ACC.savedcarts.bindPostRestoreSavedCartLink()},onClosed:function(){ACC.common.refreshScreenReaderBuffer()}})})})},bindRestoreModalHandlers:function(){ACC.savedcarts.$savedCartRestoreBtn=$(".js-save-cart-restore-btn"),ACC.savedcarts.$currentCartName=$(".js-current-cart-name"),$(".js-prevent-save-active-cart").on("change",function(e){var t;!0===$(this).prop("checked")?(ACC.savedcarts.$currentCartName.attr("disabled","disabled"),ACC.savedcarts.$savedCartRestoreBtn.removeAttr("disabled")):(ACC.savedcarts.$currentCartName.removeAttr("disabled"),""==(t=ACC.savedcarts.$currentCartName.val())&&0===t.length&&ACC.savedcarts.$savedCartRestoreBtn.attr("disabled","disabled"))}),ACC.savedcarts.$currentCartName.on("focus",function(e){$(".js-restore-current-cart-form").removeClass("has-error"),$(".js-restore-error-container").html("")}),ACC.savedcarts.$currentCartName.on("blur",function(e){""==this.value&&0===this.value.length?ACC.savedcarts.$savedCartRestoreBtn.attr("disabled","disabled"):ACC.savedcarts.$savedCartRestoreBtn.removeAttr("disabled")})},bindPostRestoreSavedCartLink:function(){var a=!0,r=!1;$(document).on("click",".js-keep-restored-cart",function(e){a=$(this).prop("checked")}),$(document).on("click",".js-prevent-save-active-cart",function(e){r=$(this).prop("checked")}),$(document).on("click",".js-save-cart-restore-btn",function(e){e.preventDefault();var e=$("#activeCartName").val(),t=$(this).data("restore-url"),e={preventSaveActiveCart:r,keepRestoredCart:a,cartName:e};$.post(t,e).done(function(e,t,a){"200"==e?(e=ACC.config.encodedContextPath+"/cart",window.location.replace(e)):(e=a.responseText.slice(1,-1),$(".js-restore-current-cart-form").addClass("has-error"),$(".js-restore-error-container").html(e),$(".js-savedcart_restore_confirm_modal").colorbox.resize())})}),$(document).on("click",".js-cancel-restore-btn",function(e){ACC.colorbox.close()})},bindDeleteSavedCartLink:function(){$(document).on("click",".js-delete-saved-cart",function(e){e.preventDefault();var e=$(this).data("savedcart-id"),t=$(this).data("delete-popup-title");ACC.colorbox.open(t,{inline:!0,className:"js-savedcart_delete_confirm_modal",href:"#popup_confirm_savedcart_delete_"+e,width:"500px",onComplete:function(){$(this).colorbox.resize()}})})},bindDeleteConfirmLink:function(){$(document).on("click",".js-savedcart_delete_confirm",function(e){e.preventDefault();e=$(this).data("savedcart-id"),e=ACC.config.encodedContextPath+"/my-account/saved-carts/"+e+"/delete";$.ajax({url:e,type:"DELETE",success:function(e){ACC.colorbox.close();var t=ACC.config.encodedContextPath+"/my-account/saved-carts";window.location.replace(t)}})}),$(document).on("click",".js-savedcart_delete_confirm_cancel",function(e){ACC.colorbox.close()})},bindSaveCartForm:function(){function t(){var e=$("#saveCart").data("saveCartTitle");ACC.colorbox.open(e,{href:"#saveCart",inline:!0,width:"620px",onOpen:function(){$("#saveCartName").val()&&ACC.savedcarts.disableSaveCartButton(!1)},onComplete:function(){$(this).colorbox.resize(),r=!1},onClosed:function(){r&&a.submit(),document.getElementById("saveCartForm").reset(),ACC.savedcarts.disableSaveCartButton(!0)}})}var a=$("#saveCartForm"),r=!1;$(document).on("click",".js-save-cart-link, .js-update-saved-cart",function(e){e.preventDefault(),ACC.common.checkAuthenticationStatusBeforeAction(t)}),$(document).on("click","#saveCart #cancelSaveCartButton",function(e){e.preventDefault(),$.colorbox.close()}),$("#saveCartName").keyup(function(){$("#saveCart #saveCartButton").prop("disabled",""==this.value.trim());$(this).val().length;$(this).val($(this).val().substring(0,255));var e=$(this).val().length;remain=255-parseInt(e),$("#saveCartName").text(remain)}),$(document).on("click","#saveCart #saveCartButton",function(e){e.preventDefault(),r=!0,$.colorbox.close()})},disableSaveCartButton:function(e){$("#saveCart #saveCartButton").prop("disabled",e)},bindUpdateUploadingSavedCarts:function(){var e=$(".js-uploading-saved-carts-update").data("idRowMapping"),t=$(".js-uploading-saved-carts-update").data("refreshCart");if(e&&t){var a=$(".js-uploading-saved-carts-update").data("refreshInterval"),r=e.split(","),n=new Object,s=[];for(i=0;i<r.length;i++){var o=r[i].split(":");""!=o&&(n[o[0]]=o[1],s.push(o[0]))}0<s.length&&setTimeout(function(){ACC.savedcarts.refreshWorker(s,n,a)},a)}},refreshWorker:function(n,s,o){$.ajax({dataType:"json",url:ACC.config.encodedContextPath+"/my-account/saved-carts/uploadingCarts",data:{cartCodes:n},type:"GET",traditional:!0,success:function(e){if(null!=e)for(i=0;i<e.length;i++){var t,a=e[i],r=$.inArray(a.code,n),r=(-1<r&&n.splice(r,1),s[a.code]);null!=r&&(r="#row-"+r,$(r+" .js-saved-cart-name").removeClass("not-active"),$(r+" .js-saved-cart-date").removeClass("hidden"),$(r+" .js-file-importing").remove(),$(r+" .js-saved-cart-description").text(a.description),t=a.entries.length,$(r+" .js-saved-cart-number-of-items").text(t),$(r+" .js-saved-cart-total").text(a.totalPrice.formattedValue),0<t&&$(r+" .js-restore-saved-cart").removeClass("hidden"),$(r+" .js-delete-saved-cart").removeClass("hidden"))}0<n.length&&setTimeout(function(){ACC.savedcarts.refreshWorker(n,s,o)},o)}})}};