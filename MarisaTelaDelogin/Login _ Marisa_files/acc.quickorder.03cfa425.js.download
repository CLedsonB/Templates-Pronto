var ACC=ACC||{};0<$("#quickOrder").length&&(ACC.quickorder={_autoload:["bindClearQuickOrderRow","bindAddSkuInputRow","bindResetFormBtn","bindAddToCartClick"],$quickOrderContainer:$(".js-quick-order-container"),$quickOrderMinRows:Number($(".js-quick-order-container").data("quickOrderMinRows")),$quickOrderMaxRows:Number($(".js-quick-order-container").data("quickOrderMaxRows")),$productExistsInFormMsg:$(".js-quick-order-container").data("productExistsInFormMsg"),$quickOrderLeavePageMsg:$("#quickOrder").data("gridConfirmMessage"),$hiddenSkuInput:"input.js-hidden-sku-field",$addToCartBtn:$("#js-add-to-cart-quick-order-btn-top, #js-add-to-cart-quick-order-btn-bottom"),$resetFormBtn:$("#js-reset-quick-order-form-btn-top, #js-reset-quick-order-form-btn-bottom"),$productInfoContainer:".js-product-info",$skuInputField:".js-sku-input-field",$qtyInputField:".js-quick-order-qty",$jsLiContainer:"li.js-li-container",$removeQuickOrderRowBtn:".js-remove-quick-order-row",$skuValidationContainer:".js-sku-validation-container",$qtyValidationContainer:".js-qty-validation-container",$productItemTotal:".js-quick-order-item-total",$classHasError:"has-error",bindResetFormBtn:function(){ACC.quickorder.$resetFormBtn.on("click",ACC.quickorder.clearForm)},bindAddToCartClick:function(){ACC.quickorder.$addToCartBtn.on("click",ACC.quickorder.addToCart)},bindAddSkuInputRow:function(){$(ACC.quickorder.$skuInputField).on("focusin",ACC.quickorder.addInputRow).on("focusout",ACC.quickorder.handleFocusOutOnSkuInput)},bindClearQuickOrderRow:function(){$(ACC.quickorder.$removeQuickOrderRowBtn).on("mousedown",ACC.quickorder.clearQuickOrderRow)},addToCart:function(){$.ajax({url:ACC.quickorder.$quickOrderContainer.data("quickOrderAddToCartUrl"),type:"POST",dataType:"json",contentType:"application/json",data:ACC.quickorder.getJSONDataForAddToCart(),async:!1,success:function(r){ACC.quickorder.handleAddToCartSuccess(r)},error:function(r,e,t){console.log("The following error occurred: "+e,t)}})},handleAddToCartSuccess:function(r){0<$(r.quickOrderErrorData).size()&&ACC.quickorder.disableBeforeUnloadEvent();var t={};r.quickOrderErrorData.forEach(function(r){t[r.sku]=r.errorMsg}),$(ACC.quickorder.$qtyInputField).each(function(){var r=ACC.quickorder.getCurrentParentLi(this),e=ACC.quickorder.findElement(r,ACC.quickorder.$skuInputField).val(),e=t[e];e?ACC.quickorder.findElement(r,ACC.quickorder.$skuValidationContainer).text(e):ACC.quickorder.findElement(r,ACC.quickorder.$removeQuickOrderRowBtn).trigger("mousedown")}),ACC.quickorder.handleBeforeUnloadEvent(),ACC.product.displayAddToCartPopup(r)},getJSONDataForAddToCart:function(){var t=[];return $(ACC.quickorder.$qtyInputField).each(function(){var r,e=Number($(this).val());0<e&&(r=jQuery.trim(ACC.quickorder.findElementInCurrentParentLi(this,ACC.quickorder.$skuInputField).val()),t.push({product:{code:r},quantity:e}))}),JSON.stringify({cartEntries:t})},handleFocusOutOnSkuInput:function(r){ACC.quickorder.handleGetProduct(r),ACC.quickorder.handleBeforeUnloadEvent()},handleFocusOutOnQtyInput:function(r){ACC.quickorder.validateAndUpdateItemTotal(r),ACC.quickorder.enableDisableAddToCartBtn()},clearForm:function(){window.location.reload()},validateAndUpdateItemTotal:function(r){var e,t,o=ACC.quickorder.getCurrentParentLi(r.target),n=jQuery.trim(ACC.productorderform.filterSkuEntry($(r.target).val()));isNaN(n)||""==n?(n=0,$(r.target).removeClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(o,ACC.quickorder.$qtyValidationContainer).text(""),$(r.target).val(0)):(n=Number(n),$(r.target).val(n),e=jQuery.trim(ACC.quickorder.findElement(o,ACC.quickorder.$qtyInputField).data("maxProductQty")),t=jQuery.trim(ACC.quickorder.findElement(o,ACC.quickorder.$qtyInputField).data("stockLevelStatus")),e=$.isEmptyObject(e)&&"inStock"==t?"FORCE_IN_STOCK":Number(e),!isNaN(e)&&e<n?($(r.target).addClass(ACC.quickorder.$classHasError),(t=ACC.quickorder.findElement(o,ACC.quickorder.$qtyValidationContainer)).text(t.data("maxProductQtyMsg")),n=e,$(r.target).val(e)):($(r.target).removeClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(o,ACC.quickorder.$qtyValidationContainer).text(""))),0<n?(t=parseFloat(ACC.quickorder.findElement(o,".js-product-price").data("productPrice")),ACC.quickorder.findElement(o,ACC.quickorder.$productItemTotal).text(ACC.productorderform.formatTotalsCurrency(t*n))):ACC.quickorder.findElement(o,ACC.quickorder.$productItemTotal).text("")},clearQuickOrderRow:function(){var r=ACC.quickorder.$quickOrderMinRows,e=ACC.quickorder.getCurrentParentLi(this);$(".js-ul-container li.js-li-container").length>r?e.remove():(ACC.quickorder.findElement(e,ACC.quickorder.$productInfoContainer).remove(),ACC.quickorder.findElement(e,ACC.quickorder.$skuValidationContainer).text(""),ACC.quickorder.findElement(e,ACC.quickorder.$skuInputField).val(""),ACC.quickorder.findElement(e,ACC.quickorder.$hiddenSkuInput).val("")),ACC.quickorder.enableDisableAddToCartBtn(),ACC.quickorder.handleBeforeUnloadEvent()},addInputRow:function(r){var e;$(".js-quick-order-container li.js-li-container:last-child").find(ACC.quickorder.$skuInputField).is($(r.target))&&$(ACC.quickorder.$jsLiContainer).length<ACC.quickorder.$quickOrderMaxRows&&(r=$(".js-quick-order-container li.js-li-container:first").clone(),ACC.quickorder.findElement(r,ACC.quickorder.$productInfoContainer).remove(),ACC.quickorder.findElement(r,ACC.quickorder.$skuValidationContainer).text(""),ACC.quickorder.findElement(r,ACC.quickorder.$hiddenSkuInput).val(""),(e=ACC.quickorder.findElement(r,ACC.quickorder.$skuInputField)).val(""),e.focusin(ACC.quickorder.addInputRow).focusout(ACC.quickorder.handleFocusOutOnSkuInput),ACC.quickorder.findElement(r,ACC.quickorder.$removeQuickOrderRowBtn).click(ACC.quickorder.clearQuickOrderRow),$(".js-ul-container").append(r))},handleGetProduct:function(r){var e=ACC.quickorder.getCurrentParentLi(r.target),t=$.trim(r.target.value);$(r.target).val(t),ACC.quickorder.isCurrentSkuSameAsPrevious(e,t)||(0<t.length?(ACC.quickorder.findElement(e,ACC.quickorder.$productInfoContainer).remove(),ACC.quickorder.isDuplicateSku(r.target,t)?ACC.quickorder.findElement(e,ACC.quickorder.$skuValidationContainer).text(ACC.quickorder.$productExistsInFormMsg):ACC.quickorder.getAndDisplayProductInfo(r,e,t),ACC.quickorder.findElement(e,ACC.quickorder.$hiddenSkuInput).val(t)):($(r.target).removeClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(e,ACC.quickorder.$skuValidationContainer).text(""),ACC.quickorder.findElement(e,ACC.quickorder.$productInfoContainer).remove()))},isCurrentSkuSameAsPrevious:function(r,e){return ACC.quickorder.findElement(r,ACC.quickorder.$hiddenSkuInput).val()==e},isDuplicateSku:function(r,e){var t=!1;return $(ACC.quickorder.$skuInputField).each(function(){if($(this).val()==e&&!$(this).is($(r)))return!(t=!0)}),t},getAndDisplayProductInfo:function(t,o,r){r=ACC.config.encodedContextPath+"/quickOrder/productInfo?code="+r;$.getJSON(r,function(r){var e;null!=r.errorMsg&&0<r.errorMsg.length?($(t.target).addClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(o,ACC.quickorder.$skuValidationContainer).text(r.errorMsg)):($(t.target).removeClass(ACC.quickorder.$classHasError),ACC.quickorder.findElement(o,ACC.quickorder.$skuValidationContainer).text(""),$("#quickOrderRowTemplate").tmpl(r.productData).insertAfter(ACC.quickorder.findElement(o,".js-sku-container")),(e=ACC.quickorder.findElement(o,ACC.quickorder.$qtyInputField)).focusout(ACC.quickorder.handleFocusOutOnQtyInput),"outOfStock"==r.productData.stock.stockLevelStatus.code?(e.val(0),e.prop("disabled",!0)):e.focus().select(),ACC.quickorder.enableDisableAddToCartBtn())})},handleBeforeUnloadEvent:function(){ACC.quickorder.isAnySkuPresent()?(ACC.quickorder.disableBeforeUnloadEvent(),ACC.quickorder.enableBeforeUnloadEvent()):ACC.quickorder.disableBeforeUnloadEvent()},disableBeforeUnloadEvent:function(){$(window).off("beforeunload",ACC.quickorder.beforeUnloadHandler)},enableBeforeUnloadEvent:function(){$(window).on("beforeunload",ACC.quickorder.beforeUnloadHandler)},beforeUnloadHandler:function(){return ACC.quickorder.$quickOrderLeavePageMsg},enableDisableAddToCartBtn:function(){ACC.quickorder.shouldAddToCartBeEnabled()?ACC.quickorder.$addToCartBtn.removeAttr("disabled"):ACC.quickorder.$addToCartBtn.attr("disabled","disabled")},shouldAddToCartBeEnabled:function(){var e=0,t=!1;return $(ACC.quickorder.$qtyInputField).each(function(){var r=this.value.trim();if(r&&(e+=parseInt(r,10)),1<=e)return!(t=!0)}),t},isAnySkuPresent:function(){var r=!1;return $(ACC.quickorder.$skuInputField).each(function(){if(jQuery.trim(this.value))return!(r=!0)}),r},getCurrentParentLi:function(r){return $(r).closest(ACC.quickorder.$jsLiContainer)},findElement:function(r,e){return $(r).find(e)},findElementInCurrentParentLi:function(r,e){return $(r).closest(ACC.quickorder.$jsLiContainer).find(e)}});